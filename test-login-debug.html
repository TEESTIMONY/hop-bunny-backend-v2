<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Debug Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3 {
            color: #333;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"],
        input[type="email"],
        input[type="password"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #3367d6;
        }
        button:disabled {
            background: #aaa;
            cursor: not-allowed;
        }
        .card {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .logs {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 3px 0;
            border-bottom: 1px solid #eee;
        }
        .log-time {
            color: #666;
        }
        .log-info { color: #0066cc; }
        .log-error { color: #cc0000; }
        .log-success { color: #006600; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            overflow-x: auto;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>Login Debug Tool</h1>
    <p>This tool helps debug authentication issues with the backend API.</p>
    
    <div class="card">
        <h2>Test Login</h2>
        <div class="form-group">
            <label for="backend-url">Backend URL:</label>
            <input type="text" id="backend-url" value="https://hop-bunny-backend-v2.vercel.app/api/login">
            <small>The full URL to your login endpoint</small>
        </div>
        
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" value="test@example.com">
        </div>
        
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" value="password123">
        </div>
        
        <div class="form-group">
            <input type="checkbox" id="remember-me">
            <label for="remember-me" style="display:inline;">Remember me</label>
        </div>
        
        <button id="login-button">Login</button>
        <button id="clear-storage">Clear Storage</button>
    </div>
    
    <div id="status-container" class="status" style="display:none;"></div>
    
    <h3>Debug Logs:</h3>
    <div id="logs" class="logs"></div>
    
    <div class="card">
        <h3>Local Storage:</h3>
        <pre id="local-storage-display"></pre>
        
        <h3>Session Storage:</h3>
        <pre id="session-storage-display"></pre>
    </div>
    
    <script>
        // DOM elements
        const backendUrlInput = document.getElementById('backend-url');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const rememberMe = document.getElementById('remember-me');
        const loginButton = document.getElementById('login-button');
        const clearStorageButton = document.getElementById('clear-storage');
        const statusContainer = document.getElementById('status-container');
        const logsContainer = document.getElementById('logs');
        const localStorageDisplay = document.getElementById('local-storage-display');
        const sessionStorageDisplay = document.getElementById('session-storage-display');
        
        // Display initial storage contents
        updateStorageDisplays();
        
        // Logging function
        function log(message, type = 'info') {
            const now = new Date();
            const timestamp = now.toLocaleTimeString() + '.' + now.getMilliseconds().toString().padStart(3, '0');
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            
            const timeSpan = document.createElement('span');
            timeSpan.className = 'log-time';
            timeSpan.textContent = `[${timestamp}] `;
            
            const messageSpan = document.createElement('span');
            messageSpan.textContent = message;
            
            logEntry.appendChild(timeSpan);
            logEntry.appendChild(messageSpan);
            
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
            
            // Also log to console for easier debugging
            if (type === 'error') {
                console.error(message);
            } else {
                console.log(message);
            }
        }
        
        // Show status message
        function showStatus(message, isSuccess) {
            statusContainer.textContent = message;
            statusContainer.className = isSuccess ? 'status success' : 'status error';
            statusContainer.style.display = 'block';
        }
        
        // Update storage displays
        function updateStorageDisplays() {
            localStorageDisplay.textContent = formatStorageContents(localStorage);
            sessionStorageDisplay.textContent = formatStorageContents(sessionStorage);
        }
        
        // Format storage contents for display
        function formatStorageContents(storage) {
            const items = {};
            for (let i = 0; i < storage.length; i++) {
                const key = storage.key(i);
                items[key] = storage.getItem(key);
            }
            return JSON.stringify(items, null, 2);
        }
        
        // Clear storage
        function clearStorage() {
            log('Clearing localStorage and sessionStorage', 'info');
            localStorage.clear();
            sessionStorage.clear();
            updateStorageDisplays();
            showStatus('Storage cleared successfully', true);
        }
        
        // Login function
        async function login() {
            const backendUrl = backendUrlInput.value.trim();
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();
            
            loginButton.textContent = 'Logging in...';
            loginButton.disabled = true;
            
            try {
                // Validate inputs
                if (!backendUrl) {
                    throw new Error('Backend URL is required');
                }
                
                if (!email || !password) {
                    throw new Error('Email and password are required');
                }
                
                log(`Login attempt for: ${email}`, 'info');
                log(`Backend URL: ${backendUrl}`, 'info');
                
                // Prepare request
                const requestBody = JSON.stringify({ email, password });
                log(`Request body: ${requestBody}`, 'info');
                
                // Make the request
                log('Sending fetch request...', 'info');
                const startTime = Date.now();
                
                const response = await fetch(backendUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: requestBody
                });
                
                const responseTime = Date.now() - startTime;
                log(`Response received in ${responseTime}ms`, 'info');
                log(`Response status: ${response.status} ${response.statusText}`, 'info');
                
                // Log response headers
                const headers = {};
                response.headers.forEach((value, key) => {
                    headers[key] = value;
                });
                log(`Response headers: ${JSON.stringify(headers, null, 2)}`, 'info');
                
                // Parse response body
                const data = await response.json();
                log(`Response body: ${JSON.stringify(data, null, 2)}`, 'info');
                
                if (!response.ok) {
                    throw new Error(data.message || `HTTP error ${response.status}`);
                }
                
                // Check if token is present
                if (!data.token) {
                    throw new Error('No authentication token returned');
                }
                
                // Store user data based on "remember me"
                if (rememberMe.checked) {
                    log('Storing auth data in localStorage (persistent)', 'info');
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('userId', data.userId || '');
                    localStorage.setItem('username', data.username || '');
                    localStorage.setItem('highScore', data.highScore || 0);
                } else {
                    log('Storing auth data in sessionStorage (temporary)', 'info');
                    sessionStorage.setItem('token', data.token);
                    sessionStorage.setItem('userId', data.userId || '');
                    sessionStorage.setItem('username', data.username || '');
                    sessionStorage.setItem('highScore', data.highScore || 0);
                }
                
                // Show success and update storage display
                showStatus(`Login successful! Welcome, ${data.username}!`, true);
                log('Authentication successful', 'success');
                updateStorageDisplays();
                
            } catch (error) {
                log(`Authentication error: ${error.message}`, 'error');
                showStatus(error.message || 'Login failed', false);
            } finally {
                loginButton.textContent = 'Login';
                loginButton.disabled = false;
            }
        }
        
        // Add event listeners
        loginButton.addEventListener('click', login);
        clearStorageButton.addEventListener('click', clearStorage);
        
        // Initial log message
        log('Login Debug Tool initialized', 'info');
        log('Ready to test authentication', 'info');
    </script>
</body>
</html> 